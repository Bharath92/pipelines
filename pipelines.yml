resources:
  - name: aql
    type: Aql
    configuration:
      sourceArtifactory: art
      query: 'items.find({"$and":[{"artifact.module.build.name":{"$eq":"native_pipeline"}},{"artifact.module.build.number":{"$eq":"8"}}]})'     
      addedProperties:
        FOO: "value1a value1b"
        BAR: "value2a value2b"
      mappings:
        - name: "a"
          input: "regex"
          output: "$1/$2"
        - name: "b"
          input: "regex"
          output: "$2/$1"
  - name: image
    type: Image
    configuration:
      imageName: imageRepo/imageName
      registry: bharath_github
      autoPull: true
      imageTag: lol
  - name: dockerbuild_gitRepo
    type: GitRepo
    configuration:
      path: bharath92/gitIssues
      gitProvider: bharath_github
#  - name: buildInfo
#    type: buildInfo
#    version:
#      buildName: app
#      buildNumber: 1
  - name: distributionRule
    type: DistributionRule
    configuration:
      sourceArtifactory: art
      cityName: "*"
      serviceName: "*"
      siteName: "*"
      countryCodes:
        - "CN"
#  - name: releaseBundle
#    type: releaseBundle
#    version:
#      name: test_release
#      version: v1.0.0
#      isSigned: true
#  - name: releaseBundle2
#    type: releaseBundle
#    version:
#      name: test
#      version: foo
#      isSigned: false
#  - name: distributionRule2
#    type: DistributionRule
#    version:
#      cityName: "Beng"
#      serviceName: "lol"
#      siteName: "test"
#      countryCodes:
#        countryCodeCount: 3
#        countryCode01: "test"
#        countryCode02: "lol"
#        countryCode03: "bol"
#    
pipelines:
  - name: app
    steps:
#      - name: bash
#        type: Bash
#        configuration:
#          environmentVariables:
#            foo: bar
#          timeoutSeconds: 2
#          nodePool: dev
#          #inputSteps:
#          #  - name: step
#          integrations:
#            - name: art
#          outputResources:
#            - name: aql
#          inputResources:
#            - name: dockerbuild_gitRepo
#              trigger: false
#            - name: image
#              
#              
#       
#        execution:
#          onExecute:
#            - printenv
#      - name: build_image
#        type: build
#        payloadType: docker
#        setup:
#          build:
#            dockerFileLocation: .
#            dockerFileName: Dockerfile
#            imageName: mill.jfrog.info:12052/docker/bharath-gitissues
#            imageTag: $PIPELINE_NAME.$RUN_NUMBER
#        requires:
#          integrations:
#            - art
#          resources:
#            - dockerbuild_gitRepo
#            
#      - name: push_image
#        type: push
#        setup:
#          push:
#            targetRepo: docker
#            publish: false
#            scan: false
#        requires:
#          integrations:
#            - art
#        triggeredBy:
#          steps:
#            - build_image
#            
#      - name: publish_build
#        type: publish
#        setup:
#          publish:
#            scan: false
#        requires:
#          integrations:
#            - art
#        triggeredBy:
#          steps:
#            - push_image
#        outputResources:
#          - buildInfo
      - name: distribute
        type: DistributeReleaseBundle
        #execution:
        #  onSuccess:
        #    - echo hi
        configuration:
          dryRun: false
          releaseBundleName: test_release
          releaseBundleVersion: v1.0.0
          integrations:
            - name: kermit_art
          inputResources:
            - name: distributionRule
#        requires:
#          integrations:
#            - kermit_art
#          steps:
#            - bash
#          resources:
#            - distributionRule
#            - releaseBundle
#   
#  - name: scan_pipelinne
#    steps:
#      - name: scan_build
#        type: scan
#        setup:
#          scan:
#            buildName: $BUILD_NAME
#            buildNumber: $BUILD_NUMBER
#        requires:
#          integrations:
#            - art
#        triggeredBy:
#          resources:
#            - buildInfo
#
